on:
  workflow_dispatch: {}
  push:
    branches: [main]
    paths:
      - apps/planner/**
concurrency:
  group: ${{ github.workflow }}
env:
  LERNA_SCOPE: "@seahax/planner"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: Setup
        run: ./.github/workflows/setup.sh
      - name: Install
        run: pnpm install --frozen-lockfile
      - name: Build
        run: |
          set -e
          npx lerna --scope="$LERNA_SCOPE" run build
          npx lerna --scope="$LERNA_SCOPE" run build:docker
      - name: Check
        run: npx lerna --scope="$LERNA_SCOPE" run check
      # TODO: Build and publish container to GitHub Container Registry.